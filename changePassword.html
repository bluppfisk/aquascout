<!DOCTYPE html PUBLIC" -//W3C//DTD XHTML 1.0 Transitional//EN""http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Reset your password</title>
    <!-- Framework CSS -->
    <!-- <link rel="stylesheet" href="css/maincss.css" type="text/css"
      media="screen, projection" />
    <link rel="stylesheet" href="css/screen.css" type="text/css" media="screen,
      projection" />
    <link rel="stylesheet" href="css/print.css" type="text/css" media="print" />
    -->
    <!--[if lt IE 8]><link rel="stylesheet" href="css/ie.css" type="text/css"
        media="screen, projection" /><![endif]-->
        <script type="text/javascript" language="javascript">

  function ChangePassword(){
    
    var newPass = document.getElementById("newPass").value;
    var cfrmPass = document.getElementById("cfrmPass").value;

    console.log("pass 1 [%s] pass2 [%s]", newPass, cfrmPass);

    if (newPass == "") {
      alert("Please enter password!");
      return;
    }

    if (cfrmPass == ""){
      alert("Please confirm your password !")
      return;
    }

    if (newPass != cfrmPass) {
      window.alert("Password mismatch !");
      return;
    }

    var url = new URL(window.location.href);
    console.log("url : %s", url);

    var token = url.searchParams.get("t");
    console.log("token : %s", token);

    if (token == null || token == ""){
      window.alert("Invalid token ! ");
      return;
    }

    var parameters;
    parameters = 'newPassword=' + newPass + '&method=reset';
    console.log ("Json : %s", parameters);
    
    URL = "http://{{.HostName}}:{{.Port}}/api/v1/users/changePassword";

    console.log("URL = %s", URL);


    var xmlhttp = new XMLHttpRequest();
    xmlhttp.onreadystatechange = function () {

      console.log("ReadyState = " + this.readyState + ", StatusCode = " + this.status);
        if (this.readyState == 4 && this.status == 200){
        var response = xmlhttp.responseText;
        console.log("OK" + response);
        window.location.replace("http://127.0.0.1:8000/api/v1/Success.html");
      }else if (this.readyState ==4 && this.status != 200){
        console.log("Error : "+ xmlhttp.responseText);
        window.location.replace("http://127.0.0.1:8000/api/v1/Success.html");
      }
    }
    xmlhttp.open("POST", URL, true);
    xmlhttp.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
    xmlhttp.setRequestHeader('Authorization', 'Bearer ' + token);
    xmlhttp.send(parameters);

  }

  function callbackFunction(xmlhttp){

    if (this.readyState == 4 && this.status == 200){
      var response = xmlhttp.responseText;
      console.log(response);
      window.location.replace('http://www.google.com')
    }
  }
        </script>
      </head>
      <body onload="document.getElementById('newPass').focus();">
        <!-- Container Begins-->
        <div class="container">&nbsp;
          <!--Header-->
            <span class="logo"></span>
            <div class="orangeline" style="margin-top:75px;">&nbsp;</div>
            <!-- Main Content Begins-->
            <div class="content marginAuto" title="Change Password">
              <div class="borders span-16">
                <div class="subcontent paddingLeft">
                  <form method="" name="formname">
                    <div class="orangeheading">Reset Password</div>
                    <div class="prepend-2 span-11 last">
                    </div>
                    <div class="span-10"><span class="span-3 rightAlign">New
                        Password</span>
                      <input id="newPass" name="newPass" type="password" />
                    </div>
                    <div class="span-10"><span class="span-3 rightAlign">Confirm
                        Password</span>
                      <input id="cfrmPass" name="cfrmPass" type="password" />
                    </div>
                    <div class="clear">&nbsp;</div>
                    <hr />
                  </div>
                  <div class="clear"></div>
                  <div class="prepend-5">
                    <input class="buttn" type="button" name="submit"
                      value="Submit"
                      style="text-decoration: none;
                      font-weight: bold;
                      color: #FFF;
                      background-color: #1ccad8;
                      border-radius: 4px;
                      padding: 10px 20px;"
                      onclick="javascript:ChangePassword()" />
                  </div>
                </form>
                <!--Subcontent Ends-->
                </div>
              </div>
            </div>
            <!--Main Content Ends-->
              <div class="footer">&nbsp;</div>
            </div>
            <!--Container Ends-->
            </body>
          </html>>